import * as tslib_1 from "tslib";
import { ObjectMaker } from "../util/object-maker";
import { MESSAGE, CONTROLS_ERROR, VALUE_CHANGED_SYNC } from '../const';
import { ApplicationUtil } from '../util/app-util';
import { DisableProvider } from '../domain/disable-provider';
import { RXCODE, MODEL_INSTANCE, PATCH } from "../const/app.const";
import { DECORATORS } from "../const/decorators.const";
import { defaultContainer } from "../core/defaultContainer";
import { SANITIZERS } from "../util/sanitizers";
import { ErrorMessageBindingStrategy } from "../enums";
import { ReactiveFormConfig } from "../util/reactive-form-config";
import { AbstractControl } from "../abstract/abstract-control";
var DIRTY = "dirty";
var TOUCHED = "touched";
var UNTOUCHED = "untouched";
var PRISTINE = "pristine";
var PENDING = "pending";
var RxFormControl = /** @class */ (function (_super) {
    tslib_1.__extends(RxFormControl, _super);
    function RxFormControl(formState, validator, asyncValidator, entityObject, baseObject, controlName, _sanitizers) {
        var _this_1 = _super.call(this, formState, validator, asyncValidator) || this;
        _this_1.entityObject = entityObject;
        _this_1.baseObject = baseObject;
        _this_1._sanitizers = _sanitizers;
        _this_1._errorMessages = [];
        _this_1._childColumns = [];
        _this_1._refDisableControls = [];
        _this_1._refMessageControls = [];
        _this_1._refClassNameControls = [];
        _this_1._isPassedExpression = false;
        _this_1._baseValue = formState === undefined ? null : _this_1.getFormState(formState);
        _this_1._isModified = false;
        _this_1.keyName = controlName;
        _this_1._errorMessageBindingStrategy = ReactiveFormConfig.get("reactiveForm.errorMessageBindingStrategy");
        _this_1.updateValueAndValidity();
        return _this_1;
    }
    Object.defineProperty(RxFormControl.prototype, "path", {
        get: function () {
            return this.parent ? this.parent.path + "." + this.keyName : "";
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "errorMessages", {
        get: function () {
            if (!this._messageExpression) {
                if (this._errorMessages.length == 0 && this.errors)
                    this.setControlErrorMessages();
            }
            else if (this._messageExpression && !this._isPassedExpression)
                return [];
            if (!this.errors && this._errorMessages.length > 0)
                this.setControlErrorMessages();
            return this._errorMessages;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RxFormControl.prototype, "errorMessage", {
        get: function () {
            if (!this._messageExpression) {
                if (this._errorMessage == undefined && this.errors)
                    this.setControlErrorMessages();
            }
            else if (this._messageExpression && !this._isPassedExpression)
                return undefined;
            if (!this.errors && this._errorMessage)
                this.setControlErrorMessages();
            return this._errorMessage;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControl.prototype.getFormState = function (value) {
        var baseValue = value;
        if (Array.isArray(value)) {
            baseValue = [];
            value.forEach(function (t) { return baseValue.push(t); });
        }
        return baseValue;
    };
    Object.defineProperty(RxFormControl.prototype, "isModified", {
        get: function () {
            return this._isModified;
        },
        enumerable: true,
        configurable: true
    });
    RxFormControl.prototype.setValue = function (value, options) {
        var parsedValue = this.getSanitizedValue(value);
        if (options && options.dirty)
            this.baseObject[this.keyName] = value;
        this.entityObject[this.keyName] = parsedValue;
        this.value = value;
        this.bindError();
        this.bindClassName();
        this.executeExpressions();
        this.callPatch();
        if (options && !options.updateChanged && this.root[VALUE_CHANGED_SYNC]) {
            this.root[VALUE_CHANGED_SYNC]();
        }
    };
    RxFormControl.prototype.getControlValue = function () {
        return this.getSanitizedValue(this.value);
    };
    RxFormControl.prototype.bindError = function () {
        if (this._messageExpression)
            this._isPassedExpression = this.executeExpression(this._messageExpression, this);
        this.setControlErrorMessages();
        this.errors = this.errors;
    };
    RxFormControl.prototype.bindClassName = function () {
        if (this.updateOnElementClass && typeof this.updateOnElementClass === "function") {
            var className = this.executeExpression(this._classNameExpression, this);
            var updateElement = this.updateOnElementClass;
            updateElement(className);
        }
    };
    RxFormControl.prototype.markAsTouched = function (opts) {
        var currentState = this.touched;
        _super.prototype.markAsTouched.call(this);
        if (currentState != this.touched)
            this.runControlPropChangeExpression([TOUCHED, UNTOUCHED]);
    };
    RxFormControl.prototype.markAsUntouched = function (opts) {
        var currentState = this.untouched;
        //super.markAsUnTouched();
        //super.markAsUnTouched();
        if (currentState != this.untouched)
            this.runControlPropChangeExpression([UNTOUCHED, TOUCHED]);
    };
    RxFormControl.prototype.markAsDirty = function (opts) {
        var currentState = this.dirty;
        _super.prototype.markAsDirty.call(this);
        if (currentState != this.dirty)
            this.runControlPropChangeExpression([DIRTY]);
    };
    RxFormControl.prototype.markAsPristine = function (opts) {
        var currentState = this.pristine;
        _super.prototype.markAsDirty.call(this);
        if (currentState != this.pristine)
            this.runControlPropChangeExpression([PRISTINE]);
    };
    RxFormControl.prototype.runControlPropChangeExpression = function (propNames) {
        var _this_1 = this;
        propNames.forEach(function (name) {
            if ((_this_1._controlProp && _this_1._messageExpression && _this_1._controlProp[name]) || (!_this_1._messageExpression && _this_1.checkErrorMessageStrategy()))
                _this_1.bindError();
            if (_this_1._classNameControlProp && _this_1._classNameControlProp[name])
                _this_1.bindClassName();
        });
    };
    RxFormControl.prototype.refresh = function () {
        this.getMessageExpression(this.parent, this.keyName);
        this.bindConditionalControls(DECORATORS.disabled, "_refDisableControls");
        this.bindConditionalControls(DECORATORS.error, "_refMessageControls");
        this.bindConditionalControls(DECORATORS.elementClass, "_refClassNameControls");
        this.executeExpressions();
        this.bindError();
    };
    RxFormControl.prototype.reset = function (value) {
        if (value !== undefined)
            this.setValue(value);
        else
            this.setValue(this.getFormState(this._baseValue));
    };
    RxFormControl.prototype.commit = function () {
        this._baseValue = this.value;
        this.callPatch();
    };
    RxFormControl.prototype.callPatch = function () {
        this._isModified = this.getValue(this._baseValue) != this.getValue(this.value);
        if (this.parent && this.parent[PATCH])
            this.parent[PATCH](this.keyName);
    };
    RxFormControl.prototype.checkErrorMessageStrategy = function () {
        var isBind = true;
        switch (this._errorMessageBindingStrategy) {
            case ErrorMessageBindingStrategy.OnSubmit:
                isBind = this.parent.submitted;
                break;
            case ErrorMessageBindingStrategy.OnDirty:
                isBind = this.dirty;
                break;
            case ErrorMessageBindingStrategy.OnDirtyOrSubmit:
                isBind = this.dirty || this.parent.submitted;
                break;
            default:
                isBind = true;
        }
        return isBind;
    };
    RxFormControl.prototype.executeExpressions = function () {
        this.processExpression("_refDisableControls", "disabled");
        this.processExpression("_refMessageControls", "bindError");
        this.processExpression("_refClassNameControls", "bindClassName");
    };
    RxFormControl.prototype.getMessageExpression = function (formGroup, keyName) {
        if (formGroup && formGroup.modelInstance) {
            var instanceContainer = defaultContainer.get(formGroup.modelInstance.constructor);
            if (instanceContainer) {
                this._messageExpression = instanceContainer.nonValidationDecorators.error.conditionalExpressions[keyName];
                this._controlProp = instanceContainer.nonValidationDecorators.error.controlProp[this.keyName];
                this._classNameExpression = instanceContainer.nonValidationDecorators.elementClass.conditionalExpressions[keyName];
                this._classNameControlProp = instanceContainer.nonValidationDecorators.elementClass.controlProp[keyName];
                if (this._classNameExpression)
                    this.updateOnElementClass = true;
            }
        }
    };
    RxFormControl.prototype.getSanitizedValue = function (value) {
        var e_1, _a;
        if (this._sanitizers) {
            try {
                for (var _b = tslib_1.__values(this._sanitizers), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var sanitizer = _c.value;
                    value = SANITIZERS[sanitizer.name](value, sanitizer.config);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return value;
    };
    RxFormControl.prototype.bindConditionalControls = function (decoratorType, refName) {
        var _this = this;
        this._disableProvider = new DisableProvider(decoratorType, this.entityObject);
        _this[refName] = this._disableProvider.zeroArgumentProcess(this, this.keyName);
        this._disableProvider.oneArgumentProcess(this, "" + this.keyName + RXCODE + "1").forEach(function (t) { return _this[refName].push(t); });
    };
    RxFormControl.prototype.setControlErrorMessages = function () {
        var _this_1 = this;
        if ((!this._messageExpression && this.checkErrorMessageStrategy()) || this._isPassedExpression) {
            this._errorMessages = [];
            if (this.errors) {
                Object.keys(this.errors).forEach(function (t) {
                    _this_1.parent[CONTROLS_ERROR][_this_1.keyName] = _this_1._errorMessage = _this_1.getErrorMessage(_this_1.errors, t);
                    if (!_this_1._errorMessage) {
                        var errorObject = ObjectMaker.toJson(t, undefined, [_this_1.errors[t][t]]);
                        _this_1.parent[CONTROLS_ERROR][_this_1.keyName] = _this_1._errorMessage = _this_1.getErrorMessage(errorObject, t);
                    }
                    _this_1._errorMessages.push(_this_1._errorMessage);
                });
            }
            else {
                this._errorMessage = undefined;
                this.parent[CONTROLS_ERROR][this.keyName] = undefined;
                delete this.parent[CONTROLS_ERROR][this.keyName];
            }
        }
        else {
            this._errorMessages = [];
            this._errorMessage = undefined;
        }
    };
    RxFormControl.prototype.getErrorMessage = function (errorObject, keyName) {
        if (errorObject[keyName][MESSAGE])
            return errorObject[keyName][MESSAGE];
        return;
    };
    RxFormControl.prototype.processExpression = function (propName, operationType) {
        var e_2, _a;
        var _this = this;
        if (_this[propName])
            try {
                for (var _b = tslib_1.__values(_this[propName]), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var controlInfo = _c.value;
                    var control = controlInfo.isRoot ? ApplicationUtil.getControl(controlInfo.controlPath, ApplicationUtil.getRootFormGroup(this)) : ApplicationUtil.getFormControl(controlInfo.controlPath, this);
                    if (control) {
                        if (operationType == "disabled") {
                            var result = this.executeExpression(controlInfo.conditionalExpression, control);
                            if (result)
                                control.disable();
                            else
                                control.enable();
                        }
                        else if (operationType == "bindError")
                            control.bindError();
                        else if (operationType == "bindClassName")
                            control.bindClassName();
                    }
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
    };
    RxFormControl.prototype.executeExpression = function (expression, control) {
        return expression.call(control.parent[MODEL_INSTANCE], control, ApplicationUtil.getParentModelInstanceValue(this), control.parent[MODEL_INSTANCE]);
    };
    RxFormControl.prototype.getValue = function (value) {
        return value !== undefined && value !== null && value !== "" ? value : "";
    };
    return RxFormControl;
}(AbstractControl));
export { RxFormControl };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jb250cm9sLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ4d2ViL3JlYWN0aXZlLWZvcm1zLyIsInNvdXJjZXMiOlsic2VydmljZXMvZm9ybS1jb250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbkQsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDdEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBQ2xELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUNsRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBRS9DLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN2RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFHL0QsSUFBTSxLQUFLLEdBQVUsT0FBTyxDQUFDO0FBQzdCLElBQU0sT0FBTyxHQUFVLFNBQVMsQ0FBQztBQUNqQyxJQUFNLFNBQVMsR0FBVSxXQUFXLENBQUM7QUFDckMsSUFBTSxRQUFRLEdBQVUsVUFBVSxDQUFDO0FBQ25DLElBQU0sT0FBTyxHQUFVLFNBQVMsQ0FBQztBQUVqQztJQUFtQyx5Q0FBZTtJQW1EOUMsdUJBQVksU0FBYyxFQUFFLFNBQWdCLEVBQUUsY0FBcUIsRUFBVSxZQUFvQyxFQUFVLFVBQWtDLEVBQUUs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YSxJQUFJLGVBQWU7NEJBQ3JDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztxQkFFL0I7aUJBQ0o7Ozs7Ozs7O2FBQUE7SUFDVCxDQUFDO0lBRU8seUNBQWlCLEdBQXpCLFVBQTBCLFVBQW9CLEVBQUUsT0FBWTtRQUN4RCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQTtJQUN0SixDQUFDO0lBRU8sZ0NBQVEsR0FBaEIsVUFBaUIsS0FBVTtRQUN2QixPQUFPLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM5RSxDQUFDO0lBRUwsb0JBQUM7QUFBRCxDQUFDLEFBblRELENBQW1DLGVBQWUsR0FtVGpEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JqZWN0TWFrZXIgfSBmcm9tIFwiLi4vdXRpbC9vYmplY3QtbWFrZXJcIjtcclxuaW1wb3J0IHsgTUVTU0FHRSwgQ09OVFJPTFNfRVJST1IsIFZBTFVFX0NIQU5HRURfU1lOQyB9IGZyb20gJy4uL2NvbnN0J1xyXG5pbXBvcnQgeyBBcHBsaWNhdGlvblV0aWwgfSBmcm9tICcuLi91dGlsL2FwcC11dGlsJ1xyXG5pbXBvcnQgeyBEaXNhYmxlUHJvdmlkZXIgfSBmcm9tICcuLi9kb21haW4vZGlzYWJsZS1wcm92aWRlcic7XHJcbmltcG9ydCB7IFJYQ09ERSwgTU9ERUxfSU5TVEFOQ0UsIFBBVENIIH0gZnJvbSBcIi4uL2NvbnN0L2FwcC5jb25zdFwiXHJcbmltcG9ydCB7IERFQ09SQVRPUlMgfSBmcm9tIFwiLi4vY29uc3QvZGVjb3JhdG9ycy5jb25zdFwiO1xyXG5pbXBvcnQgeyBkZWZhdWx0Q29udGFpbmVyIH0gZnJvbSBcIi4uL2NvcmUvZGVmYXVsdENvbnRhaW5lclwiO1xyXG5pbXBvcnQgeyBTQU5JVElaRVJTIH0gZnJvbSBcIi4uL3V0aWwvc2FuaXRpemVyc1wiXHJcbmltcG9ydCB7IERhdGFTYW5pdGl6ZXIgfSBmcm9tICcuLi9jb3JlL3ZhbGlkYXRvci5pbnRlcmZhY2UnXHJcbmltcG9ydCB7IEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneSB9IGZyb20gXCIuLi9lbnVtc1wiO1xyXG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1Db25maWcgfSBmcm9tIFwiLi4vdXRpbC9yZWFjdGl2ZS1mb3JtLWNvbmZpZ1wiO1xyXG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wgfSBmcm9tIFwiLi4vYWJzdHJhY3QvYWJzdHJhY3QtY29udHJvbFwiO1xyXG5pbXBvcnQgeyBJRm9ybUdyb3VwIH0gZnJvbSBcIi4uL21vZGVscy9pbnRlcmZhY2UvaS1mb3JtLWdyb3VwXCI7XHJcblxyXG5jb25zdCBESVJUWTpzdHJpbmcgPSBcImRpcnR5XCI7XHJcbmNvbnN0IFRPVUNIRUQ6c3RyaW5nID0gXCJ0b3VjaGVkXCI7XHJcbmNvbnN0IFVOVE9VQ0hFRDpzdHJpbmcgPSBcInVudG91Y2hlZFwiO1xyXG5jb25zdCBQUklTVElORTpzdHJpbmcgPSBcInByaXN0aW5lXCI7XHJcbmNvbnN0IFBFTkRJTkc6c3RyaW5nID0gXCJwZW5kaW5nXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUnhGb3JtQ29udHJvbCBleHRlbmRzIEFic3RyYWN0Q29udHJvbCB7XHJcbiAgICBwcml2YXRlIGtleU5hbWU6IHN0cmluZztcclxuICAgIHByaXZhdGUgX2Vycm9yTWVzc2FnZSE6IGFueTtcclxuICAgIHByaXZhdGUgX2Vycm9yTWVzc2FnZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBwcml2YXRlIF9kaXNhYmxlUHJvdmlkZXIhOiBEaXNhYmxlUHJvdmlkZXI7XHJcbiAgICBwcml2YXRlIF9jb2x1bW5zITogc3RyaW5nW107XHJcbiAgICBwcml2YXRlIF9jaGlsZENvbHVtbnM6IGFueSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBfcGFyZW50Q29sdW1ucyE6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nW10gfTtcclxuICAgIHByaXZhdGUgX3JlZkRpc2FibGVDb250cm9scz0gW107XHJcbiAgICBwcml2YXRlIF9yZWZNZXNzYWdlQ29udHJvbHMgPSBbXTtcclxuICAgIHByaXZhdGUgX3JlZkNsYXNzTmFtZUNvbnRyb2xzID0gW107XHJcbiAgICBwcml2YXRlIF9lcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3k6IEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneTtcclxuICAgIHByaXZhdGUgX21lc3NhZ2VFeHByZXNzaW9uITogRnVuY3Rpb247XHJcbiAgICBwcml2YXRlIF9jbGFzc05hbWVFeHByZXNzaW9uITogRnVuY3Rpb247XHJcbiAgICBwcml2YXRlIF9pc1Bhc3NlZEV4cHJlc3Npb246IEJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgX2NvbnRyb2xQcm9wITogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH07XHJcbiAgICBwcml2YXRlIF9jbGFzc05hbWVDb250cm9sUHJvcCE6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xyXG4gICAgcHJpdmF0ZSBfYmFzZVZhbHVlOiBhbnk7XHJcbiAgICBwcml2YXRlIF9pc01vZGlmaWVkOiBib29sZWFuO1xyXG4gICAgdXBkYXRlT25FbGVtZW50Q2xhc3MhOiBib29sZWFuIHwgRnVuY3Rpb247XHJcbiAgICBwcmVIb29rITogRnVuY3Rpb247XHJcbiAgICBwb3N0SG9vayE6IEZ1bmN0aW9uO1xyXG5cclxuICAgIGdldCBwYXRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudCA/IGAke3RoaXMucGFyZW50LnBhdGh9LiR7dGhpcy5rZXlOYW1lfWAgOiBcIlwiO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXQgZXJyb3JNZXNzYWdlcygpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fZXJyb3JNZXNzYWdlcy5sZW5ndGggPT0gMCAmJiB0aGlzLmVycm9ycylcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZih0aGlzLl9tZXNzYWdlRXhwcmVzc2lvbiAmJiAhdGhpcy5faXNQYXNzZWRFeHByZXNzaW9uKVxyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgaWYgKCF0aGlzLmVycm9ycyAmJiB0aGlzLl9lcnJvck1lc3NhZ2VzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZXJyb3JNZXNzYWdlcztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZXJyb3JNZXNzYWdlKCk6IHN0cmluZyB8IHVuZGVmaW5lZHtcclxuICAgICAgICBpZiAoIXRoaXMuX21lc3NhZ2VFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9lcnJvck1lc3NhZ2UgPT0gdW5kZWZpbmVkICYmIHRoaXMuZXJyb3JzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDb250cm9sRXJyb3JNZXNzYWdlcygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmKHRoaXMuX21lc3NhZ2VFeHByZXNzaW9uICYmICF0aGlzLl9pc1Bhc3NlZEV4cHJlc3Npb24pXHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVycm9ycyAmJiB0aGlzLl9lcnJvck1lc3NhZ2UpXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZXJyb3JNZXNzYWdlO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3IoZm9ybVN0YXRlOiBhbnksIHZhbGlkYXRvcjogYW55W10sIGFzeW5jVmFsaWRhdG9yOiBhbnlbXSwgcHJpdmF0ZSBlbnRpdHlPYmplY3Q6IHsgW2tleTogc3RyaW5nXTogYW55IH0sIHByaXZhdGUgYmFzZU9iamVjdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwgY29udHJvbE5hbWU6IHN0cmluZywgcHJpdmF0ZSBfc2FuaXRpemVyczogRGF0YVNhbml0aXplcltdKSB7XHJcbiAgICAgICAgc3VwZXIoZm9ybVN0YXRlLHZhbGlkYXRvciwgYXN5bmNWYWxpZGF0b3IpXHJcbiAgICAgICAgdGhpcy5fYmFzZVZhbHVlID0gZm9ybVN0YXRlID09PSB1bmRlZmluZWQgPyBudWxsIDogdGhpcy5nZXRGb3JtU3RhdGUoZm9ybVN0YXRlKTtcclxuICAgICAgICB0aGlzLl9pc01vZGlmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5rZXlOYW1lID0gY29udHJvbE5hbWU7XHJcbiAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5ID0gUmVhY3RpdmVGb3JtQ29uZmlnLmdldChcInJlYWN0aXZlRm9ybS5lcnJvck1lc3NhZ2VCaW5kaW5nU3RyYXRlZ3lcIikgYXMgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5O1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpOyAgICBcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEZvcm1TdGF0ZSh2YWx1ZTphbnkpIHtcclxuICAgICAgICBsZXQgYmFzZVZhbHVlID0gdmFsdWVcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgYmFzZVZhbHVlID0gW107XHJcbiAgICAgICAgICAgIHZhbHVlLmZvckVhY2godCA9PiBiYXNlVmFsdWUucHVzaCh0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiYXNlVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlzTW9kaWZpZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTW9kaWZpZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmFsdWUodmFsdWU6IGFueSwgb3B0aW9ucz86IHtcclxuICAgICAgICBkaXJ0eT86IGJvb2xlYW47XHJcbiAgICAgICAgdXBkYXRlQ2hhbmdlZD86IGJvb2xlYW47XHJcbiAgICAgICAgb25seVNlbGY/OiBib29sZWFuO1xyXG4gICAgICAgIGVtaXRFdmVudD86IGJvb2xlYW47XHJcbiAgICAgICAgaXNUaHJvdWdoRHluYW1pYz86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgICAgIGxldCBwYXJzZWRWYWx1ZSA9IHRoaXMuZ2V0U2FuaXRpemVkVmFsdWUodmFsdWUpXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZGlydHkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmJhc2VPYmplY3RbdGhpcy5rZXlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMuZW50aXR5T2JqZWN0W3RoaXMua2V5TmFtZV0gPSBwYXJzZWRWYWx1ZTtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmJpbmRFcnJvcigpO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRDbGFzc05hbWUoKTtcclxuICAgICAgICAgICAgdGhpcy5leGVjdXRlRXhwcmVzc2lvbnMoKTtcclxuICAgICAgICAgICAgdGhpcy5jYWxsUGF0Y2goKTtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgIW9wdGlvbnMudXBkYXRlQ2hhbmdlZCAmJiB0aGlzLnJvb3RbVkFMVUVfQ0hBTkdFRF9TWU5DXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb290W1ZBTFVFX0NIQU5HRURfU1lOQ10oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldENvbnRyb2xWYWx1ZSgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNhbml0aXplZFZhbHVlKHRoaXMudmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRFcnJvcigpe1xyXG4gICAgICAgIGlmKHRoaXMuX21lc3NhZ2VFeHByZXNzaW9uKVxyXG4gICAgICAgICAgICB0aGlzLl9pc1Bhc3NlZEV4cHJlc3Npb24gPSB0aGlzLmV4ZWN1dGVFeHByZXNzaW9uKHRoaXMuX21lc3NhZ2VFeHByZXNzaW9uLHRoaXMpO1xyXG4gICAgICAgIHRoaXMuc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKTtcclxuICAgICAgICB0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzO1xyXG4gICAgfVxyXG5cclxuICAgIGJpbmRDbGFzc05hbWUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgJiYgdHlwZW9mIHRoaXMudXBkYXRlT25FbGVtZW50Q2xhc3MgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICBsZXQgY2xhc3NOYW1lID0gdGhpcy5leGVjdXRlRXhwcmVzc2lvbih0aGlzLl9jbGFzc05hbWVFeHByZXNzaW9uLCB0aGlzKTtcclxuICAgICAgICAgICAgbGV0IHVwZGF0ZUVsZW1lbnQgPSB0aGlzLnVwZGF0ZU9uRWxlbWVudENsYXNzIGFzIEZ1bmN0aW9uO1xyXG4gICAgICAgICAgICB1cGRhdGVFbGVtZW50KGNsYXNzTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1hcmtBc1RvdWNoZWQob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMudG91Y2hlZDtcclxuICAgICAgICBzdXBlci5tYXJrQXNUb3VjaGVkKCk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSAhPSB0aGlzLnRvdWNoZWQpXHJcbiAgICAgICAgICAgIHRoaXMucnVuQ29udHJvbFByb3BDaGFuZ2VFeHByZXNzaW9uKFtUT1VDSEVELCBVTlRPVUNIRURdKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtYXJrQXNVbnRvdWNoZWQob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IHRoaXMudW50b3VjaGVkO1xyXG4gICAgICAgIC8vc3VwZXIubWFya0FzVW5Ub3VjaGVkKCk7XHJcbiAgICAgICAgLy9zdXBlci5tYXJrQXNVblRvdWNoZWQoKTtcclxuICAgICAgICBpZiAoY3VycmVudFN0YXRlICE9IHRoaXMudW50b3VjaGVkKVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbVU5UT1VDSEVELCBUT1VDSEVEXSlcclxuICAgIH1cclxuXHJcbiAgICBtYXJrQXNEaXJ0eShvcHRzPzoge1xyXG4gICAgICAgIG9ubHlTZWxmPzogYm9vbGVhbjtcclxuICAgIH0pOiB2b2lke1xyXG4gICAgICAgIGxldCBjdXJyZW50U3RhdGUgPSB0aGlzLmRpcnR5O1xyXG4gICAgICAgIHN1cGVyLm1hcmtBc0RpcnR5KCk7XHJcbiAgICAgICAgaWYoY3VycmVudFN0YXRlICE9IHRoaXMuZGlydHkpXHJcbiAgICAgICAgICAgIHRoaXMucnVuQ29udHJvbFByb3BDaGFuZ2VFeHByZXNzaW9uKFtESVJUWV0pXHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzUHJpc3RpbmUob3B0cz86IHtcclxuICAgICAgICBvbmx5U2VsZj86IGJvb2xlYW47XHJcbiAgICB9KTogdm9pZHtcclxuICAgICAgICBsZXQgY3VycmVudFN0YXRlID0gdGhpcy5wcmlzdGluZTtcclxuICAgICAgICBzdXBlci5tYXJrQXNEaXJ0eSgpO1xyXG4gICAgICAgIGlmKGN1cnJlbnRTdGF0ZSAhPSB0aGlzLnByaXN0aW5lKVxyXG4gICAgICAgICAgICB0aGlzLnJ1bkNvbnRyb2xQcm9wQ2hhbmdlRXhwcmVzc2lvbihbUFJJU1RJTkVdKVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgcnVuQ29udHJvbFByb3BDaGFuZ2VFeHByZXNzaW9uKHByb3BOYW1lczpzdHJpbmdbXSl7XHJcbiAgICAgICAgcHJvcE5hbWVzLmZvckVhY2gobmFtZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICgodGhpcy5fY29udHJvbFByb3AgJiYgdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gJiYgdGhpcy5fY29udHJvbFByb3BbbmFtZV0pIHx8ICghdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gJiYgdGhpcy5jaGVja0Vycm9yTWVzc2FnZVN0cmF0ZWd5KCkpKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kRXJyb3IoKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2NsYXNzTmFtZUNvbnRyb2xQcm9wICYmIHRoaXMuX2NsYXNzTmFtZUNvbnRyb2xQcm9wW25hbWVdKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5iaW5kQ2xhc3NOYW1lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVmcmVzaCgpIHtcclxuICAgICAgICB0aGlzLmdldE1lc3NhZ2VFeHByZXNzaW9uKDxhbnk+dGhpcy5wYXJlbnQsdGhpcy5rZXlOYW1lKTtcclxuICAgICAgICB0aGlzLmJpbmRDb25kaXRpb25hbENvbnRyb2xzKERFQ09SQVRPUlMuZGlzYWJsZWQsXCJfcmVmRGlzYWJsZUNvbnRyb2xzXCIpO1xyXG4gICAgICAgIHRoaXMuYmluZENvbmRpdGlvbmFsQ29udHJvbHMoREVDT1JBVE9SUy5lcnJvciwgXCJfcmVmTWVzc2FnZUNvbnRyb2xzXCIpO1xyXG4gICAgICAgIHRoaXMuYmluZENvbmRpdGlvbmFsQ29udHJvbHMoREVDT1JBVE9SUy5lbGVtZW50Q2xhc3MsIFwiX3JlZkNsYXNzTmFtZUNvbnRyb2xzXCIpO1xyXG4gICAgICAgIHRoaXMuZXhlY3V0ZUV4cHJlc3Npb25zKCk7XHJcbiAgICAgICAgdGhpcy5iaW5kRXJyb3IoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNldCh2YWx1ZT86IGFueSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUodGhpcy5nZXRGb3JtU3RhdGUodGhpcy5fYmFzZVZhbHVlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tbWl0KCkge1xyXG4gICAgICAgIHRoaXMuX2Jhc2VWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5jYWxsUGF0Y2goKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGxQYXRjaCgpIHtcclxuICAgICAgICB0aGlzLl9pc01vZGlmaWVkID0gdGhpcy5nZXRWYWx1ZSh0aGlzLl9iYXNlVmFsdWUpICE9IHRoaXMuZ2V0VmFsdWUodGhpcy52YWx1ZSk7XHJcbiAgICAgICAgaWYgKHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50W1BBVENIXSlcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnRbUEFUQ0hdKHRoaXMua2V5TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0Vycm9yTWVzc2FnZVN0cmF0ZWd5KCkge1xyXG4gICAgICAgIGxldCBpc0JpbmQ6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fZXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgIGNhc2UgRXJyb3JNZXNzYWdlQmluZGluZ1N0cmF0ZWd5Lk9uU3VibWl0OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gKDxhbnk+dGhpcy5wYXJlbnQpLnN1Ym1pdHRlZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PbkRpcnR5OlxyXG4gICAgICAgICAgICAgICAgaXNCaW5kID0gdGhpcy5kaXJ0eTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVycm9yTWVzc2FnZUJpbmRpbmdTdHJhdGVneS5PbkRpcnR5T3JTdWJtaXQ6XHJcbiAgICAgICAgICAgICAgICBpc0JpbmQgPSB0aGlzLmRpcnR5IHx8ICg8YW55PnRoaXMucGFyZW50KS5zdWJtaXR0ZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGlzQmluZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpc0JpbmQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBleGVjdXRlRXhwcmVzc2lvbnMoKXtcclxuICAgICAgICB0aGlzLnByb2Nlc3NFeHByZXNzaW9uKFwiX3JlZkRpc2FibGVDb250cm9sc1wiLFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzRXhwcmVzc2lvbihcIl9yZWZNZXNzYWdlQ29udHJvbHNcIiwgXCJiaW5kRXJyb3JcIik7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzRXhwcmVzc2lvbihcIl9yZWZDbGFzc05hbWVDb250cm9sc1wiLCBcImJpbmRDbGFzc05hbWVcIik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRNZXNzYWdlRXhwcmVzc2lvbihmb3JtR3JvdXA6IElGb3JtR3JvdXA8YW55Piwga2V5TmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGZvcm1Hcm91cCAmJiBmb3JtR3JvdXAubW9kZWxJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBsZXQgaW5zdGFuY2VDb250YWluZXI6IGFueSA9IGRlZmF1bHRDb250YWluZXIuZ2V0KGZvcm1Hcm91cC5tb2RlbEluc3RhbmNlLmNvbnN0cnVjdG9yKTtcclxuICAgICAgICAgICAgaWYoaW5zdGFuY2VDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VFeHByZXNzaW9uID0gaW5zdGFuY2VDb250YWluZXIubm9uVmFsaWRhdGlvbkRlY29yYXRvcnMuZXJyb3IuY29uZGl0aW9uYWxFeHByZXNzaW9uc1trZXlOYW1lXVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY29udHJvbFByb3AgPSBpbnN0YW5jZUNvbnRhaW5lci5ub25WYWxpZGF0aW9uRGVjb3JhdG9ycy5lcnJvci5jb250cm9sUHJvcFt0aGlzLmtleU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2xhc3NOYW1lRXhwcmVzc2lvbiA9IGluc3RhbmNlQ29udGFpbmVyLm5vblZhbGlkYXRpb25EZWNvcmF0b3JzLmVsZW1lbnRDbGFzcy5jb25kaXRpb25hbEV4cHJlc3Npb25zW2tleU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2xhc3NOYW1lQ29udHJvbFByb3AgPSBpbnN0YW5jZUNvbnRhaW5lci5ub25WYWxpZGF0aW9uRGVjb3JhdG9ycy5lbGVtZW50Q2xhc3MuY29udHJvbFByb3Bba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2xhc3NOYW1lRXhwcmVzc2lvbilcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU9uRWxlbWVudENsYXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRTYW5pdGl6ZWRWYWx1ZSh2YWx1ZTphbnkpIHtcclxuICAgICAgICBpZiAodGhpcy5fc2FuaXRpemVycykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBzYW5pdGl6ZXIgb2YgdGhpcy5fc2FuaXRpemVycykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBTQU5JVElaRVJTW3Nhbml0aXplci5uYW1lXSh2YWx1ZSxzYW5pdGl6ZXIuY29uZmlnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBiaW5kQ29uZGl0aW9uYWxDb250cm9scyhkZWNvcmF0b3JUeXBlOiBzdHJpbmcsIHJlZk5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBfdGhpcyA6YW55PSB0aGlzO1xyXG4gICAgICAgIHRoaXMuX2Rpc2FibGVQcm92aWRlciA9IG5ldyBEaXNhYmxlUHJvdmlkZXIoZGVjb3JhdG9yVHlwZSx0aGlzLmVudGl0eU9iamVjdCk7XHJcbiAgICAgICAgX3RoaXNbcmVmTmFtZV0gPSB0aGlzLl9kaXNhYmxlUHJvdmlkZXIuemVyb0FyZ3VtZW50UHJvY2Vzcyh0aGlzLHRoaXMua2V5TmFtZSlcclxuICAgICAgICB0aGlzLl9kaXNhYmxlUHJvdmlkZXIub25lQXJndW1lbnRQcm9jZXNzKHRoaXMsIGAke3RoaXMua2V5TmFtZX0ke1JYQ09ERX0xYCkuZm9yRWFjaCh0ID0+IF90aGlzW3JlZk5hbWVdLnB1c2godCkpXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0Q29udHJvbEVycm9yTWVzc2FnZXMoKSB7XHJcbiAgICAgICAgaWYgKCghdGhpcy5fbWVzc2FnZUV4cHJlc3Npb24gJiYgdGhpcy5jaGVja0Vycm9yTWVzc2FnZVN0cmF0ZWd5KCkpIHx8IHRoaXMuX2lzUGFzc2VkRXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2VzID0gW107XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVycm9ycykge1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5lcnJvcnMpLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRbQ09OVFJPTFNfRVJST1JdW3RoaXMua2V5TmFtZV0gPSB0aGlzLl9lcnJvck1lc3NhZ2UgPSB0aGlzLmdldEVycm9yTWVzc2FnZSh0aGlzLmVycm9ycywgdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9lcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVycm9yT2JqZWN0ID0gT2JqZWN0TWFrZXIudG9Kc29uKHQsIHVuZGVmaW5lZCwgW3RoaXMuZXJyb3JzW3RdW3RdXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50W0NPTlRST0xTX0VSUk9SXVt0aGlzLmtleU5hbWVdID0gdGhpcy5fZXJyb3JNZXNzYWdlID0gdGhpcy5nZXRFcnJvck1lc3NhZ2UoZXJyb3JPYmplY3QsIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2VzLnB1c2godGhpcy5fZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2UgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFtDT05UUk9MU19FUlJPUl1bdGhpcy5rZXlOYW1lXSA9IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMucGFyZW50W0NPTlRST0xTX0VSUk9SXVt0aGlzLmtleU5hbWVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2UgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEVycm9yTWVzc2FnZShlcnJvck9iamVjdDogeyBba2V5OiBzdHJpbmddOiBhbnkgfSwga2V5TmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKGVycm9yT2JqZWN0W2tleU5hbWVdW01FU1NBR0VdKVxyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3JPYmplY3Rba2V5TmFtZV1bTUVTU0FHRV07XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBwcm9jZXNzRXhwcmVzc2lvbihwcm9wTmFtZTogc3RyaW5nLCBvcGVyYXRpb25UeXBlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgX3RoaXM6YW55ID0gdGhpcztcclxuICAgICAgICBpZiAoX3RoaXNbcHJvcE5hbWVdKVxyXG4gICAgICAgICAgICBmb3IodmFyIGNvbnRyb2xJbmZvIG9mIF90aGlzW3Byb3BOYW1lXSl7XHJcbiAgICAgICAgICAgICAgICBsZXQgY29udHJvbCA9IGNvbnRyb2xJbmZvLmlzUm9vdCA/QXBwbGljYXRpb25VdGlsLmdldENvbnRyb2woY29udHJvbEluZm8uY29udHJvbFBhdGgsQXBwbGljYXRpb25VdGlsLmdldFJvb3RGb3JtR3JvdXAodGhpcykpIDogQXBwbGljYXRpb25VdGlsLmdldEZvcm1Db250cm9sKGNvbnRyb2xJbmZvLmNvbnRyb2xQYXRoLHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgaWYoY29udHJvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb25UeXBlID09IFwiZGlzYWJsZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5leGVjdXRlRXhwcmVzc2lvbihjb250cm9sSW5mby5jb25kaXRpb25hbEV4cHJlc3Npb24sIGNvbnRyb2wpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5kaXNhYmxlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5lbmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdGlvblR5cGUgPT0gXCJiaW5kRXJyb3JcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbC5iaW5kRXJyb3IoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChvcGVyYXRpb25UeXBlID09IFwiYmluZENsYXNzTmFtZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sLmJpbmRDbGFzc05hbWUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGV4ZWN1dGVFeHByZXNzaW9uKGV4cHJlc3Npb246IEZ1bmN0aW9uLCBjb250cm9sOiBhbnkpOiBCb29sZWFuIHtcclxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvbi5jYWxsKGNvbnRyb2wucGFyZW50W01PREVMX0lOU1RBTkNFXSwgY29udHJvbCwgQXBwbGljYXRpb25VdGlsLmdldFBhcmVudE1vZGVsSW5zdGFuY2VWYWx1ZSh0aGlzKSwgY29udHJvbC5wYXJlbnRbTU9ERUxfSU5TVEFOQ0VdKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0VmFsdWUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSBcIlwiID8gdmFsdWUgOiBcIlwiO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=