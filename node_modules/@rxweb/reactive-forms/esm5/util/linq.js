import * as tslib_1 from "tslib";
import { THIS } from "../const/app.const";
var Linq = /** @class */ (function () {
    function Linq() {
    }
    Linq.functionCreator = function (expression) {
        var functionSetter = [];
        var match = expression.match(/^\s*\(?\s*([^)]*)\s*\)?\s*=>(.*)/);
        var splitSelect = match[2].split(",");
        for (var i = 0; i < splitSelect.length; i++) {
            var equalToOperator = splitSelect[i].match(/^\s*\(?\s*([^)]*)\s*\)?\s*|===|!==|==|!=|>=|>|<=|<|(.*)/);
            if (equalToOperator !== null) {
                functionSetter = new Function(match[1], "return " + equalToOperator.input);
            }
            else {
                equalToOperator = splitSelect[i].match(/^\s*\(?\s*([^)]*)\s*\)?\s*=(.*)/);
                if (equalToOperator === null) {
                    functionSetter = new Function(match[1], "return " + splitSelect.input);
                }
                else {
                    functionSetter = new Function(match[1], "return " + equalToOperator.input);
                }
            }
        }
        if (splitSelect.length == 0)
            functionSetter = { accessFunction: new Function(match[1], "return " + match[2]) };
        return functionSetter;
    };
    Linq.execute = function (jObject, config, parentObject, modelInstance, isDynamicConfig) {
        var expressionFunction = isDynamicConfig ? config.dynamicConfig : config.conditionalExpression;
        var lastParam = isDynamicConfig ? config : modelInstance;
        if (parentObject && typeof expressionFunction == "string")
            expressionFunction = Linq.functionCreator(expressionFunction);
        if (parentObject && expressionFunction)
            return modelInstance && modelInstance.constructor !== Object ? expressionFunction.call(modelInstance, parentObject, jObject, lastParam) : expressionFunction(parentObject, jObject, lastParam);
        return true;
    };
    Linq.getConditionPath = function (texts) {
        var path = "";
        for (var i = 1; i < texts.length; i++)
            path += (texts.length - 1) == i ? texts[i].trim() : texts[i].trim() + ".";
        return path;
    };
    Linq.expressionParser = function (expression, isNonValidationExpression) {
        var _this = this;
        var splitExpressions = [];
        var columns = [];
        var expressionString = expression.toString();
        var expressionArguments = Linq.extractArguments(expressionString.match(/\(([^)]+)\)/g));
        if (expressionArguments.length > 0) {
            var splitTexts_1 = [];
            expressionString.replace(/\s/g, '').replace(new RegExp(/{|}/, "g"), "").split(new RegExp(/return|===|!==|==|!=|>=|>|<=|<|&&/)).forEach(function (t) {
                var e_1, _a;
                var texts = t.replace(/\(|\)/g, "").split("||");
                try {
                    for (var texts_1 = tslib_1.__values(texts), texts_1_1 = texts_1.next(); !texts_1_1.done; texts_1_1 = texts_1.next()) {
                        var text = texts_1_1.value;
                        splitTexts_1.push(text);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (texts_1_1 && !texts_1_1.done && (_a = texts_1.return)) _a.call(texts_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            });
            splitTexts_1.forEach(function (t) {
                expressionArguments.forEach(function (x, i) {
                    t = t.trim();
                    if (t.startsWith(x + '.')) {
                        var splitText = t.split('.');
                        if (splitText.length == 2 || (splitText.length >= 2 && isNonValidationExpression))
                            if (!isNonValidationExpression)
                                columns.push({ propName: splitText[1].trim(), argumentIndex: i == 3 ? 0 : i == 2 ? 1 : i == 1 ? -1 : i });
                            else
                                columns.push({ propName: _this.getConditionPath(splitText), argumentIndex: i == 3 ? 0 : i == 2 ? 1 : i == 1 ? -1 : i });
                        else {
                            var arrayProp = splitText[1].split('[');
                            var jObject = {
                                propName: splitText[splitText.length - 1].trim(),
                                objectPropName: arrayProp[0],
                                arrayIndex: arrayProp.length > 1 ? arrayProp[1].replace("]", "") : undefined,
                                argumentIndex: i === 3 ? 0 : i === 2 ? 1 : i
                            };
                            columns.push(jObject);
                        }
                    }
                });
            });
        }
        return columns;
    };
    Linq.extractArguments = function (splitTexts) {
        var expressionArguments = [THIS];
        if (splitTexts && splitTexts[0])
            splitTexts[0].split(",").forEach(function (t) { return expressionArguments.push(t.trim().replace("(", "").replace(")", "")); });
        return expressionArguments;
    };
    Linq.expressionColumns = function (expression, isNonValidationExpression) {
        if (isNonValidationExpression === void 0) { isNonValidationExpression = false; }
        var columns = [];
        var splitExpressions = [];
        if (typeof expression == "string") {
            expression.split("=>")[1].split(" && ").forEach(function (t) {
                t.split(" || ").forEach(function (x) {
                    splitExpressions.push(x.trim().split(' ')[0]);
                });
            });
            splitExpressions.forEach(function (t) {
                var splitText = t.split('.');
                if (splitText.length == 2)
                    columns.push({ propName: splitText[1].trim() });
                else {
                    var arrayProp = splitText[1].split('[');
                    var jObject = {
                        propName: splitText[splitText.length - 1].trim(),
                        objectPropName: arrayProp[0],
                        arrayIndex: arrayProp.length > 1 ? arrayProp[1].replace("]", "") : undefined
                    };
                    columns.push(jObject);
                }
            });
        }
        else {
            columns = Linq.expressionParser(expression, isNonValidationExpression);
        }
        return columns;
    };
    Linq.dynamicConfigParser = function (expression, propName) {
        var controlNames = [];
        var expressionString = expression.toString();
        var expressionArguments = Linq.extractArguments(expressionString.match(/\(([^)]+)\)/g));
        var splitString = expressionString.replace(new RegExp(/\r?\n|\r|;/g), ' ').replace(/["%()\{}=\\?ï¿½`'#<>|,;:+-]+/g, " ").split(/ /g);
        if (expressionArguments.length > 3)
            expressionArguments.splice(expressionArguments.length - 1, 1);
        expressionArguments.forEach(function (t) {
            splitString.filter(function (x) { return x != t + "." + propName && x.startsWith(t + "."); }).forEach(function (x) {
                var split = x.split('.');
                if (split.length == 2)
                    controlNames.push({ propName: x.replace(t + ".", '') });
                else {
                    var arrayProp = split[1].split('[');
                    var jObject = {
                        propName: split[split.length - 1].trim(),
                        objectPropName: arrayProp[0],
                        arrayIndex: arrayProp.length > 1 ? arrayProp[1].replace("]", "") : undefined,
                    };
                    controlNames.push(jObject);
                }
            });
        });
        return controlNames;
    };
    return Linq;
}());
export { Linq };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlucS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3Jtcy8iLCJzb3VyY2VzIjpbInV0aWwvbGlucS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQ3pDO0lBQUE7SUE0SUEsQ0FBQztJQTNJVSxvQkFBZSxHQUF0QixVQUF1QixVQUFjO1FBQ2pDLElBQUksY0FBYyxHQUFRLEVBQUUsQ0FBQztRQUM3QixJQUFJLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDakUsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN6QyxJQUFJLGVBQWUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLHlEQUF5RCxDQUFDLENBQUM7WUFDdEcsSUFBSSxlQUFlLEtBQUssSUFBSSxFQUFFO2dCQUMxQixjQUFjLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDOUU7aUJBQU07Z0JBQ0gsZUFBZSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztnQkFDMUUsSUFBSSxlQUFlLEtBQUssSUFBSSxFQUFFO29CQUMxQixjQUFjLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQzFFO3FCQUFNO29CQUNILGNBQWMsR0FBRyxJQUFJLFFBQVEsQ0FB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LENBQUMsQ0FBQztRQUNILE9BQU8sWUFBWSxDQUFDO0lBQ3hCLENBQUM7SUFDTCxXQUFDO0FBQUQsQ0FBQyxBQTVJRCxJQTRJQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRISVMgfSBmcm9tIFwiLi4vY29uc3QvYXBwLmNvbnN0XCJcclxuZXhwb3J0IGNsYXNzIExpbnEge1xyXG4gICAgc3RhdGljIGZ1bmN0aW9uQ3JlYXRvcihleHByZXNzaW9uOmFueSk6IGFueSB7XHJcbiAgICAgICAgdmFyIGZ1bmN0aW9uU2V0dGVyOiBhbnkgPSBbXTtcclxuICAgICAgICB2YXIgbWF0Y2ggPSBleHByZXNzaW9uLm1hdGNoKC9eXFxzKlxcKD9cXHMqKFteKV0qKVxccypcXCk/XFxzKj0+KC4qKS8pO1xyXG4gICAgICAgIHZhciBzcGxpdFNlbGVjdCA9IG1hdGNoWzJdLnNwbGl0KFwiLFwiKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0U2VsZWN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBlcXVhbFRvT3BlcmF0b3IgPSBzcGxpdFNlbGVjdFtpXS5tYXRjaCgvXlxccypcXCg/XFxzKihbXildKilcXHMqXFwpP1xccyp8PT09fCE9PXw9PXwhPXw+PXw+fDw9fDx8KC4qKS8pO1xyXG4gICAgICAgICAgICBpZiAoZXF1YWxUb09wZXJhdG9yICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvblNldHRlciA9IG5ldyBGdW5jdGlvbihtYXRjaFsxXSwgXCJyZXR1cm4gXCIgKyBlcXVhbFRvT3BlcmF0b3IuaW5wdXQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZXF1YWxUb09wZXJhdG9yID0gc3BsaXRTZWxlY3RbaV0ubWF0Y2goL15cXHMqXFwoP1xccyooW14pXSopXFxzKlxcKT9cXHMqPSguKikvKTtcclxuICAgICAgICAgICAgICAgIGlmIChlcXVhbFRvT3BlcmF0b3IgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvblNldHRlciA9IG5ldyBGdW5jdGlvbihtYXRjaFsxXSwgXCJyZXR1cm4gXCIgKyBzcGxpdFNlbGVjdC5pbnB1dCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uU2V0dGVyID0gbmV3IEZ1bmN0aW9uKG1hdGNoWzFdLCBcInJldHVybiBcIiArIGVxdWFsVG9PcGVyYXRvci5pbnB1dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNwbGl0U2VsZWN0Lmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICBmdW5jdGlvblNldHRlciA9IHsgYWNjZXNzRnVuY3Rpb246IG5ldyBGdW5jdGlvbihtYXRjaFsxXSwgXCJyZXR1cm4gXCIgKyBtYXRjaFsyXSkgfTtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb25TZXR0ZXI7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZXhlY3V0ZShqT2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBjb25maWc6IGFueSwgcGFyZW50T2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBtb2RlbEluc3RhbmNlOiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBpc0R5bmFtaWNDb25maWc6IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgICAgICBsZXQgZXhwcmVzc2lvbkZ1bmN0aW9uOiBGdW5jdGlvbiB8IHN0cmluZyA9IGlzRHluYW1pY0NvbmZpZyA/IGNvbmZpZy5keW5hbWljQ29uZmlnIDogY29uZmlnLmNvbmRpdGlvbmFsRXhwcmVzc2lvbjtcclxuICAgICAgICBsZXQgbGFzdFBhcmFtID0gaXNEeW5hbWljQ29uZmlnID8gY29uZmlnIDogbW9kZWxJbnN0YW5jZTtcclxuICAgICAgICBpZiAocGFyZW50T2JqZWN0ICYmIHR5cGVvZiBleHByZXNzaW9uRnVuY3Rpb24gPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgZXhwcmVzc2lvbkZ1bmN0aW9uID0gTGlucS5mdW5jdGlvbkNyZWF0b3IoZXhwcmVzc2lvbkZ1bmN0aW9uKTtcclxuICAgICAgICBpZiAocGFyZW50T2JqZWN0ICYmIGV4cHJlc3Npb25GdW5jdGlvbilcclxuICAgICAgICAgICAgcmV0dXJuIG1vZGVsSW5zdGFuY2UgJiYgbW9kZWxJbnN0YW5jZS5jb25zdHJ1Y3RvciAhPT0gT2JqZWN0ID8gKDxGdW5jdGlvbj5leHByZXNzaW9uRnVuY3Rpb24pLmNhbGwobW9kZWxJbnN0YW5jZSwgcGFyZW50T2JqZWN0LCBqT2JqZWN0LCBsYXN0UGFyYW0pIDogKDxGdW5jdGlvbj5leHByZXNzaW9uRnVuY3Rpb24pKHBhcmVudE9iamVjdCwgak9iamVjdCwgbGFzdFBhcmFtKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBnZXRDb25kaXRpb25QYXRoKHRleHRzOiBzdHJpbmdbXSk6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IHBhdGggPSBcIlwiO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGV4dHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHBhdGggKz0gKHRleHRzLmxlbmd0aCAtIDEpID09IGkgPyB0ZXh0c1tpXS50cmltKCkgOiBgJHt0ZXh0c1tpXS50cmltKCl9LmBcclxuICAgICAgICByZXR1cm4gcGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBleHByZXNzaW9uUGFyc2VyKGV4cHJlc3Npb246IGFueSwgaXNOb25WYWxpZGF0aW9uRXhwcmVzc2lvbjogYm9vbGVhbikge1xyXG4gICAgICAgIGxldCBzcGxpdEV4cHJlc3Npb25zID0gW107XHJcbiAgICAgICAgbGV0IGNvbHVtbnM6YW55ID0gW107XHJcbiAgICAgICAgbGV0IGV4cHJlc3Npb25TdHJpbmcgPSBleHByZXNzaW9uLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgbGV0IGV4cHJlc3Npb25Bcmd1bWVudHMgPSBMaW5xLmV4dHJhY3RBcmd1bWVudHMoZXhwcmVzc2lvblN0cmluZy5tYXRjaCgvXFwoKFteKV0rKVxcKS9nKSk7XHJcbiAgICAgICAgaWYgKGV4cHJlc3Npb25Bcmd1bWVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgc3BsaXRUZXh0cyA6YW55PSBbXTtcclxuICAgICAgICAgICAgZXhwcmVzc2lvblN0cmluZy5yZXBsYWNlKC9cXHMvZywgJycpLnJlcGxhY2UobmV3IFJlZ0V4cCgve3x9LywgXCJnXCIpLCBcIlwiKS5zcGxpdChuZXcgUmVnRXhwKC9yZXR1cm58PT09fCE9PXw9PXwhPXw+PXw+fDw9fDx8JiYvKSkuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCB0ZXh0cyA9IHQucmVwbGFjZSgvXFwofFxcKS9nLCBcIlwiKS5zcGxpdChcInx8XCIpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgdGV4dCBvZiB0ZXh0cylcclxuICAgICAgICAgICAgICAgICAgICBzcGxpdFRleHRzLnB1c2godGV4dCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBzcGxpdFRleHRzLmZvckVhY2goKHQ6YW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uQXJndW1lbnRzLmZvckVhY2goKHgsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0ID0gdC50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQuc3RhcnRzV2l0aCh4ICsgJy4nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BsaXRUZXh0ID0gdC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRUZXh0Lmxlbmd0aCA9PSAyIHx8IChzcGxpdFRleHQubGVuZ3RoID49IDIgJiYgaXNOb25WYWxpZGF0aW9uRXhwcmVzc2lvbikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTm9uVmFsaWRhdGlvbkV4cHJlc3Npb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHsgcHJvcE5hbWU6IHNwbGl0VGV4dFsxXS50cmltKCksIGFyZ3VtZW50SW5kZXg6IGkgPT0gMyA/IDAgOiBpID09IDIgPyAxIDogaSA9PSAxID8gLTEgOiBpIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7IHByb3BOYW1lOiB0aGlzLmdldENvbmRpdGlvblBhdGgoc3BsaXRUZXh0KSwgYXJndW1lbnRJbmRleDogaSA9PSAzID8gMCA6IGkgPT0gMiA/IDEgOiBpID09IDEgPyAtMSA6IGkgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFycmF5UHJvcCA9IHNwbGl0VGV4dFsxXS5zcGxpdCgnWycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGpPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcE5hbWU6IHNwbGl0VGV4dFtzcGxpdFRleHQubGVuZ3RoIC0gMV0udHJpbSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdFByb3BOYW1lOiBhcnJheVByb3BbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlJbmRleDogYXJyYXlQcm9wLmxlbmd0aCA+IDEgPyBhcnJheVByb3BbMV0ucmVwbGFjZShcIl1cIiwgXCJcIikgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRJbmRleDogaSA9PT0gMyA/IDAgOiBpID09PSAyID8gMSA6IGlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaChqT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb2x1bW5zO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGV4dHJhY3RBcmd1bWVudHMoc3BsaXRUZXh0czogc3RyaW5nW118bnVsbCk6IHN0cmluZ1tdIHtcclxuICAgICAgICBsZXQgZXhwcmVzc2lvbkFyZ3VtZW50czogc3RyaW5nW10gPSBbVEhJU107XHJcbiAgICAgICAgaWYgKHNwbGl0VGV4dHMgJiYgc3BsaXRUZXh0c1swXSlcclxuICAgICAgICAgICAgc3BsaXRUZXh0c1swXS5zcGxpdChcIixcIikuZm9yRWFjaCh0ID0+IGV4cHJlc3Npb25Bcmd1bWVudHMucHVzaCh0LnRyaW0oKS5yZXBsYWNlKFwiKFwiLCBcIlwiKS5yZXBsYWNlKFwiKVwiLCBcIlwiKSkpO1xyXG4gICAgICAgIHJldHVybiBleHByZXNzaW9uQXJndW1lbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBleHByZXNzaW9uQ29sdW1ucyhleHByZXNzaW9uOiBhbnksIGlzTm9uVmFsaWRhdGlvbkV4cHJlc3Npb246IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgICAgIHZhciBjb2x1bW5zID0gW107XHJcbiAgICAgICAgbGV0IHNwbGl0RXhwcmVzc2lvbnM6YW55ID0gW107XHJcbiAgICAgICAgaWYgKHR5cGVvZiBleHByZXNzaW9uID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgZXhwcmVzc2lvbi5zcGxpdChcIj0+XCIpWzFdLnNwbGl0KFwiICYmIFwiKS5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdC5zcGxpdChcIiB8fCBcIikuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzcGxpdEV4cHJlc3Npb25zLnB1c2goeC50cmltKCkuc3BsaXQoJyAnKVswXSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBzcGxpdEV4cHJlc3Npb25zLmZvckVhY2goKHQ6YW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3BsaXRUZXh0ID0gdC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNwbGl0VGV4dC5sZW5ndGggPT0gMilcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goeyBwcm9wTmFtZTogc3BsaXRUZXh0WzFdLnRyaW0oKSB9KTtcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnJheVByb3AgPSBzcGxpdFRleHRbMV0uc3BsaXQoJ1snKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgak9iamVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcE5hbWU6IHNwbGl0VGV4dFtzcGxpdFRleHQubGVuZ3RoIC0gMV0udHJpbSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RQcm9wTmFtZTogYXJyYXlQcm9wWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJheUluZGV4OiBhcnJheVByb3AubGVuZ3RoID4gMSA/IGFycmF5UHJvcFsxXS5yZXBsYWNlKFwiXVwiLCBcIlwiKSA6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goak9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb2x1bW5zID0gTGlucS5leHByZXNzaW9uUGFyc2VyKGV4cHJlc3Npb24sIGlzTm9uVmFsaWRhdGlvbkV4cHJlc3Npb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29sdW1ucztcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZHluYW1pY0NvbmZpZ1BhcnNlcihleHByZXNzaW9uOiBGdW5jdGlvbiwgcHJvcE5hbWU6IHN0cmluZyk6IGFueVtdIHtcclxuICAgICAgICBsZXQgY29udHJvbE5hbWVzOmFueVtdID0gW107XHJcbiAgICAgICAgbGV0IGV4cHJlc3Npb25TdHJpbmcgPSBleHByZXNzaW9uLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgbGV0IGV4cHJlc3Npb25Bcmd1bWVudHMgPSBMaW5xLmV4dHJhY3RBcmd1bWVudHMoZXhwcmVzc2lvblN0cmluZy5tYXRjaCgvXFwoKFteKV0rKVxcKS9nKSk7XHJcbiAgICAgICAgbGV0IHNwbGl0U3RyaW5nOiBzdHJpbmdbXSA9IGV4cHJlc3Npb25TdHJpbmcucmVwbGFjZShuZXcgUmVnRXhwKC9cXHI/XFxufFxccnw7L2cpLCAnICcpLnJlcGxhY2UoL1tcIiUoKVxce309XFxcXD/vv71gJyM8PnwsOzorLV0rL2csIFwiIFwiKS5zcGxpdCgvIC9nKTtcclxuICAgICAgICBpZiAoZXhwcmVzc2lvbkFyZ3VtZW50cy5sZW5ndGggPiAzKVxyXG4gICAgICAgICAgICBleHByZXNzaW9uQXJndW1lbnRzLnNwbGljZShleHByZXNzaW9uQXJndW1lbnRzLmxlbmd0aCAtIDEsIDEpXHJcbiAgICAgICAgZXhwcmVzc2lvbkFyZ3VtZW50cy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICBzcGxpdFN0cmluZy5maWx0ZXIoeCA9PiB4ICE9IGAke3R9LiR7cHJvcE5hbWV9YCAmJiB4LnN0YXJ0c1dpdGgoYCR7dH0uYCkpLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3BsaXQgPSB4LnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3BsaXQubGVuZ3RoID09IDIpXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbE5hbWVzLnB1c2goeyBwcm9wTmFtZTogeC5yZXBsYWNlKGAke3R9LmAsICcnKSB9KVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFycmF5UHJvcCA9IHNwbGl0WzFdLnNwbGl0KCdbJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGpPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BOYW1lOiBzcGxpdFtzcGxpdC5sZW5ndGggLSAxXS50cmltKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdFByb3BOYW1lOiBhcnJheVByb3BbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5SW5kZXg6IGFycmF5UHJvcC5sZW5ndGggPiAxID8gYXJyYXlQcm9wWzFdLnJlcGxhY2UoXCJdXCIsIFwiXCIpIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sTmFtZXMucHVzaChqT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRyb2xOYW1lcztcclxuICAgIH1cclxufVxyXG4iXX0=