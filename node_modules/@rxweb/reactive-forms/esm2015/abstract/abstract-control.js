import { VALID, INVALID, DISABLED } from "../const";
export class AbstractControl {
    constructor(value, validators, asyncValidators) {
        this.validators = validators;
        this.asyncValidators = asyncValidators;
        this._errors = {};
        this.subscribers = new Array();
        this._pristine = true;
        this._value = value;
    }
    get errors() {
        return this._errors;
    }
    set errors(value) {
        this._errors = value;
        this.onChange();
    }
    get root() {
        return this._root;
    }
    set root(value) {
        this._root = value;
    }
    get value() {
        return this._value;
    }
    set value(value) {
        this._value = value;
        this.markAsDirty();
        this.updateValueAndValidity();
    }
    get pristine() {
        return this._pristine;
    }
    get parent() {
        return this._parent;
    }
    set parent(value) {
        this._parent = value;
    }
    get valid() {
        return this.status === VALID;
    }
    get invalid() {
        return this.status === INVALID;
    }
    get enabled() {
        return this.status !== DISABLED;
    }
    get disabled() {
        return this.status === DISABLED;
    }
    get dirty() {
        return !this.pristine;
    }
    get touched() {
        return this._touched;
    }
    get untouched() {
        return !this._touched;
    }
    get status() {
        return this._status;
    }
    set status(value) {
        this._status = value;
    }
    markAsDirty() {
        this._pristine = false;
        if (this.parent)
            this.parent.markAsDirty();
    }
    markAsTouched() {
        this._touched = true;
        if (this.parent)
            this.parent.markAsTouched();
    }
    markAsUnTouched() {
        this._touched = false;
        if (this.parent)
            this.parent.markAsUnTouched();
    }
    disable() {
        this.status = DISABLED;
    }
    enable() {
        this.status = VALID;
    }
    updateValueAndValidity() {
        if (this.enabled) {
            this.runValidators();
        }
    }
    runValidators() {
        this._errors = {};
        if (this.validators) {
            this.validators.forEach(validator => {
                let result = validator(this);
                if (result)
                    this.setErrors(result);
            });
        }
        if (Object.keys(this._errors).length == 0) {
            this.status = VALID;
            this.errors = undefined;
        }
    }
    setErrors(errors) {
        Object.keys(errors).forEach(t => this._errors[t] = errors[t]);
        this.status = INVALID;
    }
    setValue(value) {
        this.value = value;
    }
    onChange() {
        this.subscribers.forEach(t => {
            t();
        });
    }
    subscribe(func) {
        this.subscribers.push(func);
    }
    destroy() {
        while (this.subscribers.length != 0)
            this.subscribers.splice(0, 1);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtY29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3Jtcy8iLCJzb3VyY2VzIjpbImFic3RyYWN0L2Fic3RyYWN0LWNvbnRyb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBVyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRTdELE1BQU0sT0FBZ0IsZUFBZTtJQUNqQyxZQUFZLEtBQVMsRUFBUyxVQUFrQixFQUFVLGVBQXVCO1FBQW5ELGVBQVUsR0FBVixVQUFVLENBQVE7UUFBVSxvQkFBZSxHQUFmLGVBQWUsQ0FBUTtRQTZKekUsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQUtsQixnQkFBVyxHQUFlLElBQUksS0FBSyxFQUFZLENBQUM7UUFqS3BELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO0lBQ3hCLENBQUM7SUFFRCxJQUFJLE1BQU07UUFDTixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksTUFBTSxDQUFDLEtBQVU7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxJQUFJLElBQUk7UUFDSixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDdEIsQ0FBQztJQUVELElBQUksSUFBSSxDQUFDLEtBQVU7UUFDZixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUN2QixDQUFDO0lBRUQsSUFBSSxLQUFLO1FBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFJLEtBQUssQ0FBQyxLQUFVO1FBQ2hCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxXQUFXLEVBQUUs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UyxDQUFDLE1BQVc7UUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzdELElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDO0lBQzFCLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBVTtRQUNmLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxRQUFRO1FBQ0osSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDekIsQ0FBQyxFQUFFLENBQUM7UUFDUixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxTQUFTLENBQUMsSUFBYztRQUNwQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsT0FBTztRQUNILE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLElBQUksQ0FBQztZQUMvQixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQztDQVdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVkFMSUQsIFBFTkRJTkcsIElOVkFMSUQsIERJU0FCTEVEIH0gZnJvbSBcIi4uL2NvbnN0XCI7XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RDb250cm9sIHtcclxuICAgIGNvbnN0cnVjdG9yKHZhbHVlOmFueSxwcml2YXRlIHZhbGlkYXRvcnM/OiBhbnlbXSwgcHJpdmF0ZSBhc3luY1ZhbGlkYXRvcnM/OiBhbnlbXSkge1xyXG4gICAgICAgIHRoaXMuX3ByaXN0aW5lID0gdHJ1ZTsgICAgICAgIFxyXG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGVycm9ycygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZXJyb3JzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBlcnJvcnModmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX2Vycm9ycyA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMub25DaGFuZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgcm9vdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcm9vdDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgcm9vdCh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5fcm9vdCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB2YWx1ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHZhbHVlKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIHRoaXMubWFya0FzRGlydHkoKVxyXG4gICAgICAgIHRoaXMudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXQgcHJpc3RpbmUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByaXN0aW5lO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBwYXJlbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudFxyXG4gICAgfVxyXG5cclxuICAgIHNldCBwYXJlbnQodmFsdWU6IGFueSkge1xyXG4gICAgICAgIHRoaXMuX3BhcmVudCA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB2YWxpZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXMgPT09IFZBTElEO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbnZhbGlkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PT0gSU5WQUxJRDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZW5hYmxlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXMgIT09IERJU0FCTEVEO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkaXNhYmxlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXMgPT09IERJU0FCTEVEO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBkaXJ0eSgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMucHJpc3RpbmU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHRvdWNoZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RvdWNoZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHVudG91Y2hlZCgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuX3RvdWNoZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHN0YXR1cygpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IHN0YXR1cyh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fc3RhdHVzID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzRGlydHkoKSB7XHJcbiAgICAgICAgdGhpcy5fcHJpc3RpbmUgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpXHJcbiAgICAgICAgICAgIHRoaXMucGFyZW50Lm1hcmtBc0RpcnR5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbWFya0FzVG91Y2hlZCgpIHtcclxuICAgICAgICB0aGlzLl90b3VjaGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpXHJcbiAgICAgICAgICAgIHRoaXMucGFyZW50Lm1hcmtBc1RvdWNoZWQoKTtcclxuICAgIH1cclxuXHJcbiAgICBtYXJrQXNVblRvdWNoZWQoKSB7XHJcbiAgICAgICAgdGhpcy5fdG91Y2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmVudClcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnQubWFya0FzVW5Ub3VjaGVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGlzYWJsZSgpIHtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IERJU0FCTEVEO1xyXG4gICAgfVxyXG5cclxuICAgIGVuYWJsZSgpIHtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IFZBTElEO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgdXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpIHtcclxuICAgICAgICBpZiAodGhpcy5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucnVuVmFsaWRhdG9ycygpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcnVuVmFsaWRhdG9ycygpIHtcclxuICAgICAgICB0aGlzLl9lcnJvcnMgPSB7fTtcclxuICAgICAgICBpZiAodGhpcy52YWxpZGF0b3JzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdG9ycy5mb3JFYWNoKHZhbGlkYXRvciA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gdmFsaWRhdG9yKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9ycyhyZXN1bHQpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5fZXJyb3JzKS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IFZBTElEO1xyXG4gICAgICAgICAgICB0aGlzLmVycm9ycyA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RXJyb3JzKGVycm9yczogYW55KSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoZXJyb3JzKS5mb3JFYWNoKHQgPT4gdGhpcy5fZXJyb3JzW3RdID0gZXJyb3JzW3RdKVxyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gSU5WQUxJRDtcclxuICAgIH1cclxuXHJcbiAgICBzZXRWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ2hhbmdlKCkge1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlcnMuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgdCgpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgc3Vic2NyaWJlKGZ1bmM6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVycy5wdXNoKGZ1bmMpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgd2hpbGUgKHRoaXMuc3Vic2NyaWJlcnMubGVuZ3RoICE9IDApXHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcnMuc3BsaWNlKDAsIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3N0YXR1czogYW55O1xyXG4gICAgcHJpdmF0ZSBfcGFyZW50OiBhbnk7XHJcbiAgICBwcml2YXRlIF9wcmlzdGluZTogYm9vbGVhbjtcclxuICAgIHByaXZhdGUgX2Vycm9yczogYW55ID0ge307XHJcbiAgICBwcml2YXRlIF92YWx1ZTogYW55O1xyXG4gICAgcHJpdmF0ZSBfcm9vdDogYW55O1xyXG4gICAgcHJpdmF0ZSBfdG91Y2hlZDogYm9vbGVhbjtcclxuXHJcbiAgICBwcml2YXRlIHN1YnNjcmliZXJzOiBGdW5jdGlvbltdID0gbmV3IEFycmF5PEZ1bmN0aW9uPigpO1xyXG59Il19