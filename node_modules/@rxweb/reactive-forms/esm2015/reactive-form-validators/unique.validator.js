import { RegexValidator } from "../util/regex-validator";
import { ObjectMaker } from "../util/object-maker";
import { AnnotationTypes } from "../core/validator.static";
import { FormProvider } from '../util/form-provider';
import { ApplicationUtil } from '../util/app-util';
import { getConfigObject } from "../util/config-provider";
export function uniqueValidator(configModel) {
    var setTimeoutFunc = (invalidateControls, controlValues) => {
        let timeOut = setTimeout(() => {
            invalidateControls.forEach(t => {
                let isMatched = controlValues.filter(x => x == t.value)[0];
                if (!isMatched)
                    t.updateValueAndValidity();
            });
            clearTimeout(timeOut);
        }, 200);
    };
    var additionalValidation = (config, fieldName, formGroup, formArray, currentValue) => {
        let indexOf = formArray.controls.indexOf(formGroup);
        let formArrayValue = [];
        if (indexOf != -1) {
            formArray.value.forEach((t, i) => {
                if (indexOf != i)
                    formArrayValue.push(t);
            });
            return config.additionalValidation(currentValue, indexOf, fieldName, formGroup.value, formArrayValue);
        }
        return false;
    };
    return (control) => {
        let config = getConfigObject(configModel, control);
        if (FormProvider.ProcessRule(control, config)) {
            if (RegexValidator.isNotBlank(control.value)) {
                let formArray = ApplicationUtil.getParentFormArray(control);
                let parentFormGroup = control.parent ? control.parent : undefined;
                let invalidateControls = [];
                let controlValues = [];
                if (formArray && parentFormGroup) {
                    let currentValue = control.value;
                    let fieldName = ApplicationUtil.getFormControlName(control);
                    let isMatched = false;
                    for (let formGroup of formArray.controls) {
                        if (formGroup != parentFormGroup) {
                            isMatched = (ApplicationUtil.toLower(formGroup.controls[fieldName].value) == ApplicationUtil.toLower(currentValue) && !(formGroup.controls[fieldName].errors && formGroup.controls[fieldName].errors[AnnotationTypes.unique]));
                            if (formGroup.controls[fieldName].errors && formGroup.controls[fieldName].errors[AnnotationTypes.unique]) {
                                var matchedControl = formArray.controls.filter(t => t.controls[fieldName] != formGroup.controls[fieldName] && ApplicationUtil.toLower(t.controls[fieldName].value) == ApplicationUtil.toLower(formGroup.controls[fieldName].value))[0];
                                if (!matchedControl)
                                    invalidateControls.push(formGroup.controls[fieldName]);
                            }
                            else
                                controlValues.push(formGroup.controls[fieldName].value);
                        }
                        if (isMatched)
                            break;
                    }
                    if (invalidateControls.length > 0)
                        setTimeoutFunc(invalidateControls, controlValues);
                    let validation = false;
                    if (config.additionalValidation) {
                        validation = additionalValidation(config, fieldName, parentFormGroup, formArray, currentValue);
                    }
                    if (isMatched && !validation)
                        return ObjectMaker.toJson(AnnotationTypes.unique, config, [control.value]);
                }
            }
        }
        return ObjectMaker.null();
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLnZhbGlkYXRvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3Jtcy8iLCJzb3VyY2VzIjpbInJlYWN0aXZlLWZvcm0tdmFsaWRhdG9ycy91bmlxdWUudmFsaWRhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbkQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzNELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbkQsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ3hELE1BQU0sVUFBVSxlQUFlLENBQUMsV0FBeUI7SUFDckQsSUFBSSxjQUFjLEdBQUcsQ0FBQyxrQkFBcUMsRUFBRSxhQUFvQixFQUFFLEVBQUU7UUFDckYsSUFBSSxPQUFPLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUM1QixrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQzdCLElBQUksU0FBUyxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUMxRCxJQUFJLENBQUMsU0FBUztvQkFDWixDQUFDLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUMvQixDQUFDLENBQUMsQ0FBQTtZQUNGLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN4QixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDVCxDQUFDLENBQUE7SUFDRCxJQUFJLG9CQUFvQixHQUFHLENBQUMsTUFBVyxFQUFFLFNBQWlC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QUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDdk8sSUFBSSxDQUFDLGNBQWM7b0NBQ2pCLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7NkJBQ3pEOztnQ0FFQyxhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7eUJBQzNEO3dCQUNELElBQUksU0FBUzs0QkFDWCxNQUFNO3FCQUNUO29CQUNELElBQUksa0JBQWtCLENBQUMsTUFBTSxHQUFHLENBQUM7d0JBQy9CLGNBQWMsQ0FBQyxrQkFBa0IsRUFBRSxhQUFhLENBQUMsQ0FBQztvQkFFcEQsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO29CQUN2QixJQUFJLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRTt3QkFDL0IsVUFBVSxHQUFHLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztxQkFDaEc7b0JBQ0QsSUFBSSxTQUFTLElBQUksQ0FBQyxVQUFVO3dCQUMxQixPQUFPLFdBQVcsQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtpQkFDN0U7YUFDRjtTQUNGO1FBQ0QsT0FBTyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDNUIsQ0FBQyxDQUFBO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFic3RyYWN0Q29udHJvbCB9IGZyb20gXCIuLi9hYnN0cmFjdC9hYnN0cmFjdC1jb250cm9sXCJcclxuaW1wb3J0IHsgVmFsaWRhdG9yRm4gfSBmcm9tICcuLi9tb2RlbHMvaW50ZXJmYWNlL3ZhbGlkYXRvci1mbidcclxuaW1wb3J0IHsgUnhGb3JtQXJyYXkgfSBmcm9tIFwiLi4vc2VydmljZXMvcngtZm9ybS1hcnJheVwiXHJcbmltcG9ydCB7IFJlZ2V4VmFsaWRhdG9yIH0gZnJvbSBcIi4uL3V0aWwvcmVnZXgtdmFsaWRhdG9yXCI7XHJcbmltcG9ydCB7IE9iamVjdE1ha2VyIH0gZnJvbSBcIi4uL3V0aWwvb2JqZWN0LW1ha2VyXCI7XHJcbmltcG9ydCB7IFVuaXF1ZUNvbmZpZyB9IGZyb20gXCIuLi9tb2RlbHMvY29uZmlnL3VuaXF1ZS1jb25maWdcIjtcclxuaW1wb3J0IHsgQW5ub3RhdGlvblR5cGVzIH0gZnJvbSBcIi4uL2NvcmUvdmFsaWRhdG9yLnN0YXRpY1wiO1xyXG5pbXBvcnQgeyBGb3JtUHJvdmlkZXIgfSBmcm9tICcuLi91dGlsL2Zvcm0tcHJvdmlkZXInO1xyXG5pbXBvcnQgeyBBcHBsaWNhdGlvblV0aWwgfSBmcm9tICcuLi91dGlsL2FwcC11dGlsJztcclxuaW1wb3J0IHtnZXRDb25maWdPYmplY3R9IGZyb20gXCIuLi91dGlsL2NvbmZpZy1wcm92aWRlclwiO1xyXG5leHBvcnQgZnVuY3Rpb24gdW5pcXVlVmFsaWRhdG9yKGNvbmZpZ01vZGVsOiBVbmlxdWVDb25maWcpOiBWYWxpZGF0b3JGbiB7XHJcbiAgICB2YXIgc2V0VGltZW91dEZ1bmMgPSAoaW52YWxpZGF0ZUNvbnRyb2xzOiBBYnN0cmFjdENvbnRyb2xbXSwgY29udHJvbFZhbHVlczogYW55W10pID0+IHtcclxuICAgIGxldCB0aW1lT3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGludmFsaWRhdGVDb250cm9scy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgIGxldCBpc01hdGNoZWQgPSBjb250cm9sVmFsdWVzLmZpbHRlcih4ID0+IHggPT0gdC52YWx1ZSlbMF1cclxuICAgICAgICBpZiAoIWlzTWF0Y2hlZClcclxuICAgICAgICAgIHQudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xyXG4gICAgICB9KVxyXG4gICAgICBjbGVhclRpbWVvdXQodGltZU91dCk7XHJcbiAgICB9LCAyMDApXHJcbiAgfVxyXG4gIHZhciBhZGRpdGlvbmFsVmFsaWRhdGlvbiA9IChjb25maWc6IGFueSwgZmllbGROYW1lOiBzdHJpbmcsIGZvcm1Hcm91cDogQWJzdHJhY3RDb250cm9sLCBmb3JtQXJyYXk6IFJ4Rm9ybUFycmF5LCBjdXJyZW50VmFsdWU6IGFueSkgPT4ge1xyXG4gICAgbGV0IGluZGV4T2YgPSBmb3JtQXJyYXkuY29udHJvbHMuaW5kZXhPZihmb3JtR3JvdXApO1xyXG4gICAgbGV0IGZvcm1BcnJheVZhbHVlOmFueVtdID0gW107XHJcbiAgICBpZiAoaW5kZXhPZiAhPSAtMSkge1xyXG4gICAgICBmb3JtQXJyYXkudmFsdWUuZm9yRWFjaCgodCwgaSkgPT4ge1xyXG4gICAgICAgIGlmIChpbmRleE9mICE9IGkpXHJcbiAgICAgICAgICBmb3JtQXJyYXlWYWx1ZS5wdXNoKHQpXHJcbiAgICAgIH0pXHJcbiAgICAgIHJldHVybiBjb25maWcuYWRkaXRpb25hbFZhbGlkYXRpb24oY3VycmVudFZhbHVlLCBpbmRleE9mLCBmaWVsZE5hbWUsIGZvcm1Hcm91cC52YWx1ZSwgZm9ybUFycmF5VmFsdWUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICB9XHJcbiAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0+IHtcclxuICAgIGxldCBjb25maWcgPSBnZXRDb25maWdPYmplY3QoY29uZmlnTW9kZWwsY29udHJvbCk7XHJcbiAgICBpZiAoRm9ybVByb3ZpZGVyLlByb2Nlc3NSdWxlKGNvbnRyb2wsIGNvbmZpZykpIHtcclxuICAgICAgaWYgKFJlZ2V4VmFsaWRhdG9yLmlzTm90QmxhbmsoY29udHJvbC52YWx1ZSkpIHtcclxuICAgICAgICBsZXQgZm9ybUFycmF5ID0gQXBwbGljYXRpb25VdGlsLmdldFBhcmVudEZvcm1BcnJheShjb250cm9sKTtcclxuICAgICAgICBsZXQgcGFyZW50Rm9ybUdyb3VwID0gY29udHJvbC5wYXJlbnQgPyBjb250cm9sLnBhcmVudCA6IHVuZGVmaW5lZDtcclxuICAgICAgICBsZXQgaW52YWxpZGF0ZUNvbnRyb2xzOiBBYnN0cmFjdENvbnRyb2xbXSA9IFtdO1xyXG4gICAgICAgIGxldCBjb250cm9sVmFsdWVzID0gW107XHJcbiAgICAgICAgaWYgKGZvcm1BcnJheSAmJiBwYXJlbnRGb3JtR3JvdXApIHtcclxuICAgICAgICAgIGxldCBjdXJyZW50VmFsdWUgPSBjb250cm9sLnZhbHVlO1xyXG4gICAgICAgICAgbGV0IGZpZWxkTmFtZSA9IEFwcGxpY2F0aW9uVXRpbC5nZXRGb3JtQ29udHJvbE5hbWUoY29udHJvbCk7XHJcbiAgICAgICAgICBsZXQgaXNNYXRjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgICBmb3IgKGxldCBmb3JtR3JvdXAgb2YgZm9ybUFycmF5LmNvbnRyb2xzKSB7XHJcbiAgICAgICAgICAgIGlmIChmb3JtR3JvdXAgIT0gcGFyZW50Rm9ybUdyb3VwKSB7XHJcbiAgICAgICAgICAgICAgaXNNYXRjaGVkID0gKEFwcGxpY2F0aW9uVXRpbC50b0xvd2VyKGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLnZhbHVlKSA9PSBBcHBsaWNhdGlvblV0aWwudG9Mb3dlcihjdXJyZW50VmFsdWUpICYmICEoZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0uZXJyb3JzICYmIGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLmVycm9yc1tBbm5vdGF0aW9uVHlwZXMudW5pcXVlXSkpXHJcbiAgICAgICAgICAgICAgaWYgKGZvcm1Hcm91cC5jb250cm9sc1tmaWVsZE5hbWVdLmVycm9ycyAmJiBmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS5lcnJvcnNbQW5ub3RhdGlvblR5cGVzLnVuaXF1ZV0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXRjaGVkQ29udHJvbCA9IGZvcm1BcnJheS5jb250cm9scy5maWx0ZXIodCA9PiB0LmNvbnRyb2xzW2ZpZWxkTmFtZV0gIT0gZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0gJiYgQXBwbGljYXRpb25VdGlsLnRvTG93ZXIodC5jb250cm9sc1tmaWVsZE5hbWVdLnZhbHVlKSA9PSBBcHBsaWNhdGlvblV0aWwudG9Mb3dlcihmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS52YWx1ZSkpWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVkQ29udHJvbClcclxuICAgICAgICAgICAgICAgICAgaW52YWxpZGF0ZUNvbnRyb2xzLnB1c2goZm9ybUdyb3VwLmNvbnRyb2xzW2ZpZWxkTmFtZV0pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xWYWx1ZXMucHVzaChmb3JtR3JvdXAuY29udHJvbHNbZmllbGROYW1lXS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlzTWF0Y2hlZClcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChpbnZhbGlkYXRlQ29udHJvbHMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgc2V0VGltZW91dEZ1bmMoaW52YWxpZGF0ZUNvbnRyb2xzLCBjb250cm9sVmFsdWVzKTtcclxuXHJcbiAgICAgICAgICBsZXQgdmFsaWRhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYgKGNvbmZpZy5hZGRpdGlvbmFsVmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICB2YWxpZGF0aW9uID0gYWRkaXRpb25hbFZhbGlkYXRpb24oY29uZmlnLCBmaWVsZE5hbWUsIHBhcmVudEZvcm1Hcm91cCwgZm9ybUFycmF5LCBjdXJyZW50VmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGlzTWF0Y2hlZCAmJiAhdmFsaWRhdGlvbilcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdE1ha2VyLnRvSnNvbihBbm5vdGF0aW9uVHlwZXMudW5pcXVlLCBjb25maWcsIFtjb250cm9sLnZhbHVlXSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBPYmplY3RNYWtlci5udWxsKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==