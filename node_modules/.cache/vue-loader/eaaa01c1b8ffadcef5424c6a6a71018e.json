{"remainingRequest":"/home/cmurray/britevue-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/cmurray/britevue-frontend/src/components/RecentReviews/RecentReviews.vue?vue&type=style&index=0&id=06da97de&lang=scss&scoped=true&","dependencies":[{"path":"/home/cmurray/britevue-frontend/src/components/RecentReviews/RecentReviews.vue","mtime":1628691920056},{"path":"/home/cmurray/britevue-frontend/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/cmurray/britevue-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/cmurray/britevue-frontend/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/cmurray/britevue-frontend/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/cmurray/britevue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/cmurray/britevue-frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICcuL1JlY2VudFJldmlld3Muc2Nzcyc7Cgo="},{"version":3,"sources":["RecentReviews.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkGA","file":"RecentReviews.vue","sourceRoot":"src/components/RecentReviews","sourcesContent":["<template>\n<div class=\"recent-activity py-5\">\n  <div id=\"activities-icon\" class=\"recent-activity__separator\">\n    <img src=\"@/assets/images/activities.svg\" alt=\"\">\n  </div>\n  \n    <div class=\"container\">\n          <h3 class=\"recent-activity__title\">Recent Activity</h3>\n          <div v-if=\"loadingReviews\" class=\"recent-activity__title\">\n            <b-spinner class=\"spinner\"/>\n          </div>\n          <div class=\"row\" v-if=\"activities.length > 0\">\n            <div class=\"col\">\n              \n              <div class=\"row\">\n                <div class=\"col-12 col-sm-6 col-md-4\" v-for=\"activity in activities.slice(0,showImages)\" :key=\"activity.id\">\n                  <div class=\"activity-card\">\n                    <!-- <div class=\"activity-card__header\"></div> -->\n                    <div class=\"activity-card__body\">\n                      <p v-on:click=\"getRoutePath('place', { id: activity.placeID })\" class=\"activity-card__header-placename\" >{{activity.locationName}}</p>\n                      <div v-on:click=\"getRoutePath('place', { id: activity.placeID })\" class=\"mb-3\">\n                        <img  v-if=\"activity.photos != null && activity.photos.length > 0\" :src=\"activity.photos[0].url\"  @error=\"imageUrlAlt\" class=\"activity-card__body-image\" alt=\"Card image cap\">\n                        <img v-else src=\"@/assets/images/activity-default-image.png\" alt=\"Card image cap\" class=\"activity-card__body-image\">\n                      </div>\n                      <!--<h5 class=\"card-title\">{{ activity.title }}</h5>-->\n\n                      <div class=\"activity-card__header-info\">\n                        <div class=\"row align-items-center\">\n                          <div class=\"col-auto pr-0\">\n                            <img v-if=\"activity.userInfo.profilePhoto.url == ''\" class=\"activity-card__header-image\" :id=\"`user-activity-`+activity.id\"  src=\"@/assets/images/person.png\" alt=\"Card image cap\">\n                            <img v-else class=\"activity-card__header-image\" :id=\"`user-activity-`+activity.id\"  :src=\"activity.userInfo.profilePhoto.url\" alt=\"Card image cap\">\n                          </div>\n                          <div class=\"col\">\n                            <p class=\"activity-card__header-name clickable\" @click=\"getRoutePath('profile',{'id':activity.userInfo.id})\">{{ activity.userInfo.firstName }} {{ activity.userInfo.lastName }}</p>\n                            <p class=\"activity-card__header-date\" >Wrote a review on  {{ new Date(activity.timestamp).toDateString() }}</p>\n                          </div>\n                          <div class=\"col-auto\">\n                            <div class=\"place-card__rating\" :class=\"activity.paywall && activity.paywall.cost != 0 ? 'blur' : ''\">\n                              <img src=\"@/assets/images/star.svg\" alt=\"Rating\" />\n                              <p>\n                                <span class=\"place-card__rating-value\">{{ activity.ratingAverage }}</span>\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      <p class=\"activity-card__body-text\" :class=\"activity.paywall && activity.paywall.cost != 0 ? 'blur' : ''\">{{activity.reviewBody}}</p>\n                      <!--<p class=\"user-rep\">User Rep: &lt;!&ndash;{{ activity.user.reputation }}&ndash;&gt;</p>-->\n                    </div>\n                    <div class=\"activity-card__footer\">\n                      <div class=\"row\" :class=\"activity.paywall && activity.paywall.cost != 0 ? 'blur' : ''\">\n                        <div class=\"col-auto pr-0\">\n                          <div class=\"activity-card__footer-vote custom-tooltip\"  @click=\"upvote(activity.id,$event)\"  v-if=\"user\">\n                            <b-spinner :id=\"`upvote-spinner-`+activity.id\" class=\"spinner  d-none\"/>\n                            <img  :id=\"`upvote-icon-`+activity.id\"  src=\"@/assets/images/upvote.svg\" alt=\"Up Vote\">\n                            <span :id=\"`upvote-`+activity.id\">{{ activity.upvotes }}</span>\n                          </div>\n                        </div>\n                        <div class=\"col-auto\">\n                          <div class=\"activity-card__footer-vote\" @click=\"downvote(activity.id,$event)\"  v-if=\"user\">\n                            <b-spinner :id=\"`downvote-spinner-`+activity.id\" class=\"spinner d-none\"/>\n                            <img  :id=\"`downvote-icon-`+activity.id\" src=\"@/assets/images/downvote.svg\" alt=\"Down Vote\">\n                            <span :id=\"`downvote-`+activity.id\">{{ activity.downvotes }}</span>\n                          </div>\n                        </div>\n                        <div class=\"col text-right\" v-if=\"user\">\n                          <div v-if=\"activity.user!=user.id && user.wallet!=''\">\n                            <Tip :tip-status=\"tipStatus\" @onSubmit=\"onSubmit\" :user-id=\"activity.user\" :review-id=\"activity.id\"></Tip>\n                          </div>\n\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"row\">\n                <div class=\"col text-center\">\n                  <div v-if=\"activities.length > showImages\"  v-on:click=\"showMoreImages()\" class=\"recent-activity__show-more\">\n                    <img src=\"@/assets/images/arrow_down.svg\" alt=\"Show More\">\n                    <p class=\"\">Show More Reviews</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n      <div class=\"row\">\n        <div class=\"col-12\">\n          <Modal :show-handcash-modal=\"showHandcashModal\" :title=\"'Top Up!'\" :body=\"'You need to reset your spending limit in the Handcash app'\" :icon=\"'times-circle'\" :actions=\"[{ text:'Open Handcash', url:'https://app.handcash.io/', variant:'handcash', target:'_blank' }]\"></Modal>\n        </div>\n      </div>\n\n    </div>\n  \n</div>\n</template>\n<style lang=\"scss\" scoped>\n@import './RecentReviews.scss';\n\n</style>\n<script lang=\"ts\">\nimport {Vue, Component, Inject, Prop} from 'vue-property-decorator';\nimport {IReview} from \"@/interfaces/IReview.ts\";\nimport {UserService} from \"@/services/UserService\";\nimport {ReviewsService} from \"@/services/ReviewsService\";\nimport {IUser} from \"@/interfaces/IUser\";\nimport Login from \"@/components/Login/Login.vue\";\nimport Signup from \"@/components/Signup/Signup.vue\";\nimport Tip from \"@/components/Tip/Tip.vue\";\nimport Modal from \"@/components/Modal/Modal.vue\";\n@Component({\n  components: {\n    Tip,\n    Modal\n  }\n})\nexport default class RecentReviews extends Vue{\n\n  @Inject('userService')\n  user_service!: UserService;\n\n  @Inject('reviewsService')\n  review_ser!: ReviewsService;\n  showImages: number;\n  activities:  IReview[] ;\n  tipStatus: boolean;\n  loadingReviews: boolean;\n  showHandcashModal: boolean;\n\n  @Prop() user!:  IUser | null;\n\n  constructor() {\n    super();\n    this.showImages=6;\n    this.loadingReviews=false;\n    this.activities = [];\n    this.tipStatus=false;\n    this.showHandcashModal=false;\n  }\n  async mounted(){\n    await  this.loadActivities();\n  }\n  async loadActivities(){\n    this.loadingReviews=true\n\n    const reviews = await this.review_ser.getRecentActivities();\n\n    if (reviews.length > 0) {\n      this.activities = reviews;\n    }\n    this.loadingReviews=false\n  }\n\n\n  imageUrlAlt(event: any) {\n    event.target.src = require('@/assets/images/test/restaurant.png');\n  }\n\n  showMoreImages() {\n    this.showImages +=6;\n  }\n  getRoutePath(name: string, parameters: any) {\n    return this.$router.push({name: name, params: parameters});\n  }\n\n  async onSubmit(value: any,userId: any,reviewId: any ){\n    const sendTip = await this.review_ser.sendTip(value,userId,reviewId);\n    if (sendTip.status == 200) {\n      this.$emit('success', 'Your Tip has been sent successfully');\n      this.tipStatus=true;\n    }else if(sendTip.status==555){\n      this.showHandcashModal=true;\n      this.tipStatus=false;\n    }\n    else{\n      this.$emit('error', sendTip.data.message);\n      this.tipStatus=false;\n    }\n  }\n\n  async upvote(review_id: string, e: any) {\n    e.preventDefault();\n\n    if(this.checkUserWallet()){\n      const spinner=document.getElementById('upvote-spinner-' + review_id) as HTMLElement;\n      const upvoteElement=document.getElementById('upvote-' + review_id) as HTMLElement;\n      const upvoteIcon=document.getElementById('upvote-icon-' + review_id) as HTMLElement;\n      spinner.classList.remove('d-none');\n      upvoteElement.classList.add('d-none');\n      upvoteIcon.classList.add('d-none');\n      const res = await this.review_ser.upvoteReview(this.user!.id, review_id);\n      spinner.classList.add('d-none');\n      upvoteElement.classList.remove('d-none');\n      upvoteIcon.classList.remove('d-none');\n      if (res.status == 200) {\n        const upvoteResult = res.data\n        if (typeof upvoteResult.txid != 'undefined') {\n          const vote = upvoteElement!.textContent;\n          upvoteElement!.innerHTML = (parseInt(vote!) + 1).toString();\n          this.$emit('success', 'Successfully upvoted review');\n        }\n      } else if (res.status == 555) {\n        this.showHandcashModal=true;\n      } else {\n        const msg = res.data.message\n        if (typeof msg != 'undefined') {\n          this.$emit('error', msg);\n        }\n      }\n    }\n  }\n  async downvote(review_id: string, e: any) {\n    e.preventDefault();\n    if(this.checkUserWallet()){\n      const spinner=document.getElementById('downvote-spinner-' + review_id) as HTMLElement;\n      const downvoteElement=document.getElementById('downvote-' + review_id) as HTMLElement;\n      const downvoteIcon=document.getElementById('downvote-icon-' + review_id) as HTMLElement;\n      spinner.classList.remove('d-none');\n      downvoteElement.classList.add('d-none');\n      downvoteIcon.classList.add('d-none');\n      const res = await this.review_ser.downReview(this.user!.id, review_id);\n      spinner.classList.add('d-none');\n      downvoteElement.classList.remove('d-none');\n      downvoteIcon.classList.remove('d-none');\n      if (res.status == 200) {\n        const downvoteResult = res.data\n        if (typeof downvoteResult.txid != 'undefined') {\n          const vote = downvoteElement!.textContent;\n          downvoteElement!.innerHTML = (parseInt(vote!) + 1).toString();\n          this.$emit('success', 'Successfully downvoted review');\n        }\n      } else {\n        const msg = res.data.message\n        if (typeof msg != 'undefined') {\n          this.$emit('error', msg);\n        }\n      }\n    }\n  }\n  checkUserWallet() {\n    if (this.user) {\n      if (this.user.wallet) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n}\n</script>\n"]}]}